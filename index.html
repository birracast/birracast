<!DOCTYPE html> 
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meus Achadinhos</title>
  <style>
    :root { --card: #fff; --bg:#f5f5f5; --border:#e5e5e5; --text:#111; --muted:#666; }
    body { font-family: Arial, sans-serif; padding: 24px; background: var(--bg); color: var(--text); }
    header { text-align:center; margin-bottom: 28px; }
    header h1 { margin: 0 0 6px; font-size: 40px; }
    header p { margin: 0; color: var(--muted); font-size: 18px; }
    .status { text-align:center; margin: 18px 0; color: var(--muted); }
    .produto {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      margin: 0 auto 24px;
      max-width: 840px;
      border: 1px solid var(--border);
      box-shadow: 0 4px 10px rgba(0,0,0,.06);
    }
    .produto h2 { margin: 0 0 14px; font-size: 22px; text-align:center; }
    .links {
      margin-top: 14px;
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .links a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 60px; height: 60px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #ddd;
      text-decoration: none;
      overflow: hidden;
      transition: transform .2s, box-shadow .2s;
    }
    .links a:hover { transform: scale(1.07); box-shadow: 0 6px 14px rgba(0,0,0,.18); }
    .links img { max-width: 70%; max-height: 70%; object-fit: contain; }
    .instagram-media { margin: 0 auto !important; max-width: 500px !important; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <header>
    <h1>Meus Achadinhos</h1>
    <p>Produtos incríveis que você precisa conhecer!</p>
  </header>

  <div id="status" class="status">Carregando produtos…</div>
  <div id="produtos"></div>

  <!-- PapaParse para ler CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- Script do Instagram para embed -->
  <script async src="https://www.instagram.com/embed.js"></script>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQQe0VCTsh6KYIJ54EjpnqppZaTxZhmZ0d9kWf31SkSkO6RQxYcVg7TOx6GNB2PyGDP581EmW6ogph/pub?gid=0&single=true&output=csv";

    const COLS = {
      produto: ["Produto","produto","Nome","Título","Titulo"],
      instagram: ["VideoInstagram","Instagram","LinkInstagram","Video","PostInstagram"],
      amazon: ["LinkAmazon","Amazon"],
      ml: ["LinkMercadoLivr","LinkMercadoLivre","MercadoLivre","ML"],
      shopee: ["LinkShopee","Shopee"]
    };

    const get = (row, keys) => {
      for (const k of keys) {
        const foundKey = Object.keys(row).find(h => h.trim() === k);
        if (foundKey && String(row[foundKey]).trim()) return String(row[foundKey]).trim();
      }
      return "";
    };

    const normalizeIg = (url) => {
      if (!url) return "";
      let u = url.trim();
      if (!u.startsWith("http")) u = "https://" + u.replace(/^\/\//,"");
      if (!u.endsWith("/")) u += "/";
      return u;
    };

    function processInstagrams(retries = 12) {
      if (window.instgrm && window.instgrm.Embeds && typeof window.instgrm.Embeds.process === "function") {
        window.instgrm.Embeds.process();
      } else if (retries > 0) {
        setTimeout(() => processInstagrams(retries - 1), 500);
      }
    }

    Papa.parse(sheetUrl, {
      download: true,
      header: true,
      skipEmptyLines: "greedy",
      complete: function (results) {
        const container = document.getElementById("produtos");
        const status = document.getElementById("status");

        const rows = results.data
          .map(r => {
            const clean = {};
            Object.keys(r).forEach(k => clean[k.trim()] = r[k]);
            return clean;
          })
          .filter(r => Object.values(r).some(v => String(v).trim()));

        let rendered = 0;

        rows.forEach(item => {
          const nome = get(item, COLS.produto);
          if (!nome) return;

          const ig   = normalizeIg(get(item, COLS.instagram));
          const az   = get(item, COLS.amazon);
          const ml   = get(item, COLS.ml);
          const sp   = get(item, COLS.shopee);

          const card = document.createElement("div");
          card.className = "produto";

          const igBlock = ig ? `<blockquote class="instagram-media" data-instgrm-permalink="${ig}" data-instgrm-version="14"></blockquote>` : "";

          card.innerHTML = `
            <h2>${nome}</h2>
            ${igBlock}
            <div class="links">
              ${az ? `<a href="${az}" target="_blank" rel="noopener"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg" alt="Amazon"></a>` : ""}
              ${ml ? `<a href="${ml}" target="_blank" rel="noopener"><img src="https://http2.mlstatic.com/frontend-assets/ui-navigation/5.21.3/mercadolibre/logo-pt__large_plus.png" alt="Mercado Livre"></a>` : ""}
              ${sp ? `<a href="${sp}" target="_blank" rel="noopener"><img src="https://seeklogo.com/images/S/shopee-logo-9B62304A46-seeklogo.com.png" alt="Shopee"></a>` : ""}
            </div>
          `;

          container.appendChild(card);
          rendered++;
        });

        if (rendered === 0) {
          status.textContent = "Nenhum produto encontrado. Verifique os nomes das colunas da planilha (Produto, VideoInstagram, LinkAmazon, LinkMercadoLivre/LinkMercadoLivr, LinkShopee).";
        } else {
          status.classList.add("hidden");
          processInstagrams();
        }
      },
      error: function(err) {
        const status = document.getElementById("status");
        status.textContent = "Erro ao carregar a planilha: " + (err && err.message ? err.message : "verifique o link do CSV publicado");
      }
    });
  </script>
</body>
</html>
